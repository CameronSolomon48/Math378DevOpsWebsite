---
title: "Penguins EDA"
format:
  html:
    code-fold: true
---

## Why EDA?
  In this section we will complete various exploratory data analysis tasks. This will help us identify features of the data set and which models and modeling techniques are most appropriate.

## Opening the data set:

```{r, warning=FALSE, message=FALSE}
library(palmerpenguins)
library(dplyr)
library(ggplot2)
library(dbplyr)
library(duckdb)
library(vetiver)

df <- palmerpenguins::penguins
```

```{r, warning=FALSE, message=FALSE}
df %>%
  group_by(species, sex) %>%
  summarise(
    across(
      where(is.numeric), 
      \(x) mean(x, na.rm = TRUE)
      )
    ) %>%
  knitr::kable()
```
The table above shows the first 18 lines of the data. We can now see that we are dealing with 3 types of penguins (Adelie, Chinstrap, and Gentoo).
Moreover, we have various record statistics about individual penguins including sex, bill characteristics, flipper length,and body mass. 

## Penguin Mass by Species:

Now we will examine a few plots of various penguins statistics to get a better feel of how the data interacts. We are most interested in how the other statistics impact body mass.

```{r, warning=FALSE, message=FALSE}
df %>%
  ggplot(aes(x = bill_length_mm, y = body_mass_g, color = species)) +
  geom_point() + 
  geom_smooth(method = "lm")
```

```{r, warning=FALSE, message=FALSE}
df %>%
  ggplot(aes(x = bill_depth_mm, y = body_mass_g, color = species)) +
  geom_point() + 
  geom_smooth(method = "lm")
```

```{r, warning=FALSE, message=FALSE}
df %>%
  ggplot(aes(x = flipper_length_mm, y = body_mass_g, color = species)) +
  geom_point() + 
  geom_smooth(method = "lm")
```

```{r, warning=FALSE, message=FALSE}
df %>%
  ggplot(aes(x = year, y = body_mass_g, color = species)) +
  geom_point()
```

```{r, warning=FALSE, message=FALSE}
boxplot(body_mass_g~year, data = df)
```

```{r, warning=FALSE, message=FALSE}
df %>%
  ggplot(aes(x = sex, y = body_mass_g, color = species)) +
  geom_point() + 
  geom_smooth(method = "lm")
```

```{r, warning=FALSE, message=FALSE}
boxplot(body_mass_g~sex, data = df)
```

Now that we have some visuals we can start to produce models based on the data. These models will help us evaluate the data and make predictions.

## Connecting to DuckDB:

```{r, warning=FALSE, message=FALSE}
con <- DBI::dbConnect(
  duckdb::duckdb(), 
  dbdir = "my-db.duckdb"
  )
```

```{r, warning=FALSE, message=FALSE}
#DBI::dbWriteTable(con, "penguins", palmerpenguins::penguins)
df <- dplyr::tbl(con, "penguins") 
```

```{r, warning=FALSE, message=FALSE}
library(dplyr)
df %>%
  group_by(species, sex) %>%
  summarise(
    across(
        ends_with("mm") | ends_with("g"),
      \(x) mean(x, na.rm = TRUE)
      )
    ) %>%
  dplyr::collect() %>%
  knitr::kable()
```

```{r, warning=FALSE, message=FALSE} 
DBI::dbDisconnect(con, shutdown=T)
```
 